<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Hexo Theme Keep">
    <meta name="description" content="å¥½çœ‹çš„çš®å›Šåƒä¸‡ç§ï¼Œæœ‰è¶£çš„çµé­‚ä¸‡é‡ŒæŒ‘ä¸€ã€‚">
    <meta name="author" content="TLHorse">
    
    <title>
        
            æ‰‹æŠŠæ‰‹æ•™ä½ ç©è½¬CrackMeç ´è§£äº”æ­¥èµ° |
        
        ğŸ´ æ…ç‹¬é˜
    </title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="shortcut icon" href="/images/favicon.svg">
    <link rel="stylesheet" href="/css/font-awesome.min.css">
    <script id="hexo-configurations">
    let KEEP = window.KEEP || {};
    KEEP.hexo_config = {"hostname":"tlhorse.github.io","root":"/","language":"zh-CN","path":"search.xml"};
    KEEP.theme_config = {"toc":{"enable":true,"number":false,"expand_all":false},"style":{"primary_color":"#0066CC","avatar":"/images/avatar.png","favicon":"/images/favicon.svg","article_img_align":"left","left_side_width":"260px","content_max_width":"920px","hover":{"shadow":true,"scale":true},"first_screen":{"enable":true,"background_img":"/images/bg.svg","description":"å¥½çœ‹çš„çš®å›Šåƒä¸‡ç§ï¼Œæœ‰è¶£çš„çµé­‚ä¸‡é‡ŒæŒ‘ä¸€ã€‚"},"scroll":{"progress_bar":{"enable":false},"percent":{"enable":false}}},"local_search":{"enable":true,"preload":true},"code_copy":{"enable":false,"style":"default"},"pjax":{"enable":false},"lazyload":{"enable":false},"version":"3.3.2"};
    KEEP.language_ago = {"second":"%s ç§’å‰","minute":"%s åˆ†é’Ÿå‰","hour":"%s å°æ—¶å‰","day":"%s å¤©å‰","week":"%s å‘¨å‰","month":"%s æœˆå‰","year":"%s å¹´å‰"};
  </script>
<meta name="generator" content="Hexo 5.3.0"><link rel="stylesheet" href="/css/prism.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>


<body>
<div class="progress-bar-container">
    

    
</div>


<main class="page-container">

    

    <div class="page-main-content">

        <div class="page-main-content-top">
            <header class="header-wrapper">

    <div class="header-content">
        <div class="left">
            <a class="logo-title" href="/">
                ğŸ´ æ…ç‹¬é˜
            </a>
        </div>

        <div class="right">
            <div class="pc">
                <ul class="menu-list">
                    
                        <li class="menu-item">
                            <a class=""
                               href="/"
                            >
                                é¦–é¡µ
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/archives"
                            >
                                å½’æ¡£
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/categories"
                            >
                                åˆ†ç±»
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/tags"
                            >
                                æ ‡ç­¾
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/links"
                            >
                                å‹é“¾
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/about"
                            >
                                å…³äº
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/changelog"
                            >
                                æ›´æ–°æ—¥å¿—
                            </a>
                        </li>
                    
                    
                        <li class="menu-item search search-popup-trigger">
                            <i class="fas fa-search"></i>
                        </li>
                    
                </ul>
            </div>
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div>
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/">é¦–é¡µ</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/archives">å½’æ¡£</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/categories">åˆ†ç±»</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/tags">æ ‡ç­¾</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/links">å‹é“¾</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/about">å…³äº</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/changelog">æ›´æ–°æ—¥å¿—</a>
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle">

            <div class="main-content">

                
                    <div class="fade-in-down-animation">
    <div class="article-content-container">

        <div class="article-title">
            <span class="title-hover-animation">æ‰‹æŠŠæ‰‹æ•™ä½ ç©è½¬CrackMeç ´è§£äº”æ­¥èµ°</span>
        </div>

        
            <div class="article-header">
                <div class="avatar">
                    <img src="/images/avatar.png">
                </div>
                <div class="info">
                    <div class="author">
                        <span class="name">TLHorse</span>
                        <span class="level">Lv6</span>
                    </div>
                    <div class="meta-info">
                        <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fas fa-edit"></i>&nbsp;2021-02-17 14:44:56
    </span>
    
        <span class="article-categories article-meta-item">
            <i class="fas fa-folder"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/categories/%E5%8F%8D%E7%BC%96%E8%AF%91/">åç¼–è¯‘</a>&nbsp;
                    </li>
                
                    <li>
                        &gt; <a href="/categories/%E5%8F%8D%E7%BC%96%E8%AF%91/%E7%BC%96%E7%A8%8B/">ç¼–ç¨‹</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    
    
        <span class="article-tags article-meta-item">
            <i class="fas fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/%E6%B3%A8%E5%86%8C%E6%9C%BA/">æ³¨å†Œæœº</a>&nbsp;
                    </li>
                
                    <li>
                        | <a href="/tags/Swift/">Swift</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
        <span class="article-wordcount article-meta-item">
            <i class="fas fa-file-word"></i>&nbsp;<span>5.6k å­—</span>
        </span>
    
    
        <span class="article-min2read article-meta-item">
            <i class="fas fa-clock"></i>&nbsp;<span>27 åˆ†é’Ÿ</span>
        </span>
    
    
</div>

                    </div>
                </div>
            </div>
        

        <div class="article-content markdown-body">
            <blockquote>
<p><a class="link"   target="_blank" rel="noopener" href="http://www.52pojie.cn/" >www.52pojie.cn<i class="fas fa-external-link-alt"></i></a></p>
<p>ä½œè€…ï¼š@TLHorse</p>
<p>åŸåˆ›ä½œå“ï¼Œå¾çˆ±ç ´è§£é¦–å‘</p>
</blockquote>
<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>æœ¬æ–‡æ‰€ç ´è§£çš„CrackMeå‡ºè‡ªå›½å¤–MSJè®ºå›çš„ç«èµ›é¢˜ç›®ï¼ŒåŸé¢˜ä¼°è®¡æ‰¾ä¸ç€äº†ï¼Œæ‰€ä»¥æˆ‘å…±äº«åœ¨å¦‚ä¸‹é“¾è½½ï¼š</p>
<blockquote>
<p>é“¾æ¥ï¼š<a class="link"   target="_blank" rel="noopener" href="https://share.weiyun.com/hGwzo5p4" >https://share.weiyun.com/hGwzo5p4<i class="fas fa-external-link-alt"></i></a></p>
<p>å¯†ç ï¼š5828dk</p>
</blockquote>
<p>è¿™ä¸ªappæˆ‘å·²ç»æ‰“å¼€å¹¶é€†å‘è¿‡ï¼Œç¡®è®¤æ²¡æœ‰ç—…æ¯’ï¼Œå¦‚æœä½ è¿˜ä¸æ”¾å¿ƒå¯ä»¥æ‹‰åˆ°è™šæ‹Ÿæœºé‡Œã€‚<strong>ä¸ºäº†é¿å…è¿è§„ï¼Œæˆ‘é€†å‘å»é™¤äº†appé‡Œçš„MSJé“¾æ¥ï¼ˆç‚¹å‡»<code>Help me!</code>ä¸ä¼šè·³è½¬ï¼‰ã€‚</strong>æˆ‘çœ‹ä¹Ÿæ²¡æœ‰å¤šå°‘äººç ´è§£ï¼ŒmacOS CMä¹ŸæŒºå°‘çš„ï¼Œå°±æ‹¿æ¥åˆ†æä¸€ä¸‹ã€‚</p>
<p>é¢˜ç›®ä¸­çš„äº”éƒ¨èµ°åŒ…æ‹¬ï¼š</p>
<ul>
<li>åˆ†æ</li>
<li>æš´åŠ›ç ´è§£</li>
<li>Hook</li>
<li>ä»£ç è¿˜åŸ</li>
<li>å†™æ³¨å†Œæœº</li>
</ul>
<p><strong>macOSä¸‹çš„é€†å‘å¾ˆå°‘è¢«äººæåŠï¼Œä¼¼ä¹å¾ˆå†·é—¨ï¼Œæˆ‘ä»Šå¤©åˆ†æè¿™ä¸ªCrackMeï¼Œæ¶µç›–è¿™å››éƒ¨åˆ†ï¼Œå¸Œæœ›å¯¹ç”¨macOSçš„æœ‹å‹æœ‰å¸®åŠ©ã€‚</strong></p>
<h1 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h1><p><img src="https://cdn.jsdelivr.net/gh/TLHorse/TLBlogBed@master/2021/02/17/pie-view.png" alt="pie-view"></p>
<p>æ‰“å¼€çœ‹ä¸€ä¸‹ä¸»é¡µé¢ï¼Œè¿™ä¸ªCMå’Œåˆ«çš„ä¸å¤ªç›¸åŒçš„æ˜¯ï¼Œå®ƒæ²¡æœ‰â€œç¡®è®¤â€â€œéªŒè¯â€ä¹‹ç±»çš„æŒ‰é’®ã€‚éšä¾¿è¾“å…¥å‡ ç»„å€¼éƒ½éƒ½æ²¡æœ‰ååº”ã€‚ <strong>æˆ‘ä»¬çŒœæµ‹è¿™ä¸ªCMä¼šåœ¨è¡¨å•å˜åŠ¨æ—¶é‡å¤åˆ·æ–°éªŒè¯</strong>ï¼Œåœ¨ç¬¦å·è¡¨é‡Œæœç´¢åˆ°çš„<code>serialFieldDidChange</code>éªŒè¯äº†æˆ‘ä»¬çš„æƒ³æ³•ï¼š</p>
<pre class="line-numbers language-objective-c" data-language="objective-c"><code class="language-objective-c">&#x2F;* @class PieAppDelegate *&#x2F;
-(void)serialFieldDidChange &#123;
    &#x2F;&#x2F; init UserDefaultsï¼ŒAppleå¼€å‘çš„éƒ½çŸ¥é“è¿™æ˜¯æ•°æ®æŒä¹…åŒ–
    r15 &#x3D; (@selector(standardUserDefaults))(@class(NSUserDefaults), &amp;@selector(standardUserDefaults));
    &#x2F;&#x2F; è®¾ç½®UserDefaults
    (@selector(setObject:forKey:))(r15, &amp;@selector(setObject:forKey:), (@selector(stringValue))(self-&gt;nameField, &amp;@selector(stringValue)), @&quot;name&quot;);
    (@selector(setObject:forKey:))(r15, &amp;@selector(setObject:forKey:), (@selector(stringValue))(self-&gt;serialField, &amp;@selector(stringValue)), @&quot;serial&quot;);
    &#x2F;&#x2F; éªŒè¯
    (@selector(verifySerial:andName:))(self, &amp;@selector(verifySerial:andName:), (@selector(stringValue))(self-&gt;serialField, &amp;@selector(stringValue)), (@selector(stringValue))(self-&gt;nameField, &amp;@selector(stringValue)));
    return;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>æˆ‘ä»¬å¯ä»¥è½»æ¾å‘ç°ï¼Œ<code>verifySerial:andName:</code>å°±æ˜¯éªŒè¯ç”¨æˆ·åå¯†ç çš„å…³é”®å‡½æ•°ã€‚è¿™ä¸ªCMæœ‰åè°ƒè¯•ï¼Œæˆ‘å°±æ‹¿<code>frida-trace</code>è¿›è¡Œè·Ÿè¸ªï¼Œ<strong>å‘ç°æ¯è¾“å…¥ä¸€ä¸ªå­—ç¬¦ï¼Œå°±ä¼šå°†æ­¤å‡½æ•°è°ƒç”¨ä¸€æ¬¡</strong>ï¼Œæ›´å°è¯äº†æˆ‘ä»¬çš„çŒœæµ‹ã€‚</p>
<h1 id="æš´åŠ›ç ´è§£"><a href="#æš´åŠ›ç ´è§£" class="headerlink" title="æš´åŠ›ç ´è§£"></a>æš´åŠ›ç ´è§£</h1><p>è¯ä¸å¤šè¯´ï¼Œå…ˆè€ƒè™‘æš´ç ´ã€‚ä¸è¿‡åœ¨åŠ¨æ‰‹æ”¹äºŒè¿›åˆ¶å‰ï¼Œæˆ‘ä»¬å¾—å…ˆç„å‡†ä¸€ä¸ªç‚¹ï¼Œåˆ°åº•æ”¹å“ªå‘¢ï¼Ÿæˆ‘å°±è¯•è¯•<code>verifySerial:andName:</code>å§ï¼Œæ±‡ç¼–ä»£ç å¦‚ä¸‹ï¼ˆæˆ‘æŠŠå¤±è´¥çš„æ ‡ç­¾ä»<code>loc_xxx</code>æ”¹ä¸º<code>failure</code>ï¼‰ï¼š</p>
<pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">                     -[PieAppDelegate verifySerial:andName:]:
0000000100001342         push       rbp
0000000100001343         mov        rbp, rsp
0000000100001346         mov        qword [rbp+var_28], rbx
000000010000134a         mov        qword [rbp+var_20], r12
000000010000134e         mov        qword [rbp+var_18], r13
0000000100001352         mov        qword [rbp+var_10], r14
0000000100001356         mov        qword [rbp+var_8], r15
000000010000135a         sub        rsp, 0xd0
0000000100001361         mov        qword [rbp+var_60], rdi
0000000100001365         mov        r13, rdx
0000000100001368         mov        r14, rcx
000000010000136b         mov        rdi, qword [qword_100002768]
0000000100001372         mov        edx, 0x4
0000000100001377         lea        rsi, qword [0x1000022b8]
000000010000137e         call       qword [0x1000022b8]
0000000100001384         mov        r15, rax
0000000100001387         lea        rsi, qword [0x1000022c8]
000000010000138e         mov        rdi, r13
0000000100001391         call       qword [0x1000022c8]
0000000100001397         cmp        rax, 0x10
000000010000139b         jne        failure

00000001000013a1         mov        edx, 0x6
00000001000013a6         lea        rsi, qword [0x1000022d8]
00000001000013ad         mov        rdi, r13
00000001000013b0         call       qword [0x1000022d8]
00000001000013b6         mov        rdi, rax
00000001000013b9         mov        edx, 0x4
00000001000013be         lea        rsi, qword [0x1000022b8]
00000001000013c5         call       qword [0x1000022b8]
00000001000013cb         mov        rbx, rax
00000001000013ce         lea        rsi, qword [0x1000022c8]
00000001000013d5         mov        rdi, rax
00000001000013d8         call       qword [0x1000022c8]
00000001000013de         mov        r12, rax
00000001000013e1         lea        rsi, qword [0x1000022e8]
00000001000013e8         mov        rdi, rbx
00000001000013eb         call       qword [0x1000022e8]
00000001000013f1         mov        rdi, rax
00000001000013f4         xor        edx, edx
00000001000013f6         mov        rsi, r12
00000001000013f9         call       imp___symbol_stub1__MD5
00000001000013fe         mov        rdx, qword [objc_cls_ref_NSString]
0000000100001405         mov        qword [rbp+var_58], rdx
0000000100001409         movzx      r9d, byte [rax+2]
000000010000140e         movzx      r8d, byte [rax+1]
0000000100001413         movzx      ecx, byte [rax]
0000000100001416         movzx      edx, byte [rax+0xf]
000000010000141a         mov        dword [rsp+0xd0+var_70], edx
000000010000141e         movzx      edx, byte [rax+0xe]
0000000100001422         mov        dword [rsp+0xd0+var_78], edx
0000000100001426         movzx      edx, byte [rax+0xd]
000000010000142a         mov        dword [rsp+0xd0+var_80], edx
000000010000142e         movzx      edx, byte [rax+0xc]
0000000100001432         mov        dword [rsp+0xd0+var_88], edx
0000000100001436         movzx      edx, byte [rax+0xb]
000000010000143a         mov        dword [rsp+0xd0+var_90], edx
000000010000143e         movzx      edx, byte [rax+0xa]
0000000100001442         mov        dword [rsp+0xd0+var_98], edx
0000000100001446         movzx      edx, byte [rax+9]
000000010000144a         mov        dword [rsp+0xd0+var_A0], edx
000000010000144e         movzx      edx, byte [rax+8]
0000000100001452         mov        dword [rsp+0xd0+var_A8], edx
0000000100001456         movzx      edx, byte [rax+7]
000000010000145a         mov        dword [rsp+0xd0+var_B0], edx
000000010000145e         movzx      edx, byte [rax+6]
0000000100001462         mov        dword [rsp+0xd0+var_B8], edx
0000000100001466         movzx      edx, byte [rax+5]
000000010000146a         mov        dword [rsp+0xd0+var_C0], edx
000000010000146e         movzx      edx, byte [rax+4]
0000000100001472         mov        dword [rsp+0xd0+var_C8], edx
0000000100001476         movzx      eax, byte [rax+3]
000000010000147a         mov        dword [rsp+0xd0+var_D0], eax
000000010000147d         lea        rdx, qword [cfstring__02X_02X_02X_02X_02X_02X_02X_02X_02X_02X_02X_02X_02X_02X_02X_02X]
0000000100001484         lea        rsi, qword [0x1000022f8]
000000010000148b         mov        rdi, qword [rbp+var_58]
000000010000148f         xor        eax, eax
0000000100001491         call       qword [0x1000022f8]
0000000100001497         mov        rdi, rax
000000010000149a         mov        rdx, qword [qword_100002770]
00000001000014a1         lea        rsi, qword [0x100002308]
00000001000014a8         call       qword [0x100002308]
00000001000014ae         test       al, al
00000001000014b0         je         failure

00000001000014b6         mov        edx, 0xd
00000001000014bb         lea        rsi, qword [0x100002318]
00000001000014c2         mov        rdi, r13
00000001000014c5         call       qword [0x100002318]
00000001000014cb         cmp        ax, 0x46
00000001000014cf         jne        failure

00000001000014d5         mov        edx, 0x4
00000001000014da         lea        rsi, qword [0x1000022b8]
00000001000014e1         mov        rdi, r14
00000001000014e4         call       qword [0x1000022b8]
00000001000014ea         mov        rbx, rax
00000001000014ed         lea        rsi, qword [0x1000022c8]
00000001000014f4         mov        rdi, rax
00000001000014f7         call       qword [0x1000022c8]
00000001000014fd         mov        r12, rax
0000000100001500         lea        rsi, qword [0x1000022e8]
0000000100001507         mov        rdi, rbx
000000010000150a         call       qword [0x1000022e8]
0000000100001510         mov        rdi, rax
0000000100001513         xor        edx, edx
0000000100001515         mov        rsi, r12
0000000100001518         call       imp___symbol_stub1__MD5
000000010000151d         movzx      r9d, byte [rax+2]
0000000100001522         movzx      r8d, byte [rax+1]
0000000100001527         movzx      ecx, byte [rax]
000000010000152a         movzx      edx, byte [rax+7]
000000010000152e         mov        dword [rsp+0xd0+var_B0], edx
0000000100001532         movzx      edx, byte [rax+6]
0000000100001536         mov        dword [rsp+0xd0+var_B8], edx
000000010000153a         movzx      edx, byte [rax+5]
000000010000153e         mov        dword [rsp+0xd0+var_C0], edx
0000000100001542         movzx      edx, byte [rax+4]
0000000100001546         mov        dword [rsp+0xd0+var_C8], edx
000000010000154a         movzx      eax, byte [rax+3]
000000010000154e         mov        dword [rsp+0xd0+var_D0], eax
0000000100001551         lea        rdx, qword [cfstring__02X_02X_02X_02X_02X_02X_02X]
0000000100001558         lea        rsi, qword [0x1000022f8]
000000010000155f         mov        rdi, qword [rbp+var_58]
0000000100001563         xor        eax, eax
0000000100001565         call       qword [0x1000022f8]
000000010000156b         mov        rdi, rax
000000010000156e         mov        edx, 0x7
0000000100001573         lea        rsi, qword [0x1000022d8]
000000010000157a         call       qword [0x1000022d8]
0000000100001580         mov        rbx, rax
0000000100001583         mov        qword [rbp+var_38], 0x7
000000010000158b         mov        qword [rbp+var_40], 0x6
0000000100001593         mov        edx, 0x6
0000000100001598         mov        ecx, 0x7
000000010000159d         lea        rsi, qword [0x100002328]
00000001000015a4         mov        rdi, r13
00000001000015a7         call       qword [0x100002328]
00000001000015ad         mov        rdi, rax
00000001000015b0         mov        rdx, rbx
00000001000015b3         lea        rsi, qword [0x100002308]
00000001000015ba         call       qword [0x100002308]
00000001000015c0         test       al, al
00000001000015c2         je         failure

00000001000015c8         mov        qword [rbp+var_48], 0x2
00000001000015d0         mov        qword [rbp+var_50], 0xe
00000001000015d8         mov        edx, 0xe
00000001000015dd         mov        ecx, 0x2
00000001000015e2         lea        rsi, qword [0x100002328]
00000001000015e9         mov        rdi, r13
00000001000015ec         call       qword [0x100002328]
00000001000015f2         mov        rdi, rax
00000001000015f5         mov        edx, 0x4
00000001000015fa         lea        rsi, qword [0x1000022b8]
0000000100001601         call       qword [0x1000022b8]
0000000100001607         mov        rdi, rax
000000010000160a         mov        rdx, r15
000000010000160d         lea        rsi, qword [0x100002338]
0000000100001614         call       qword [0x100002338]
000000010000161a         test       al, al
000000010000161c         je         failure
                        ; ä¸‹é¢çš„ä¸€æ®µæ˜¯æˆåŠŸæ³¨å†Œçš„ä»£ç 
000000010000161e         mov        rdi, qword [objc_cls_ref_NSNotificationCenter]
0000000100001625         lea        rsi, qword [0x100002238]
000000010000162c         call       qword [0x100002238]
0000000100001632         mov        rdi, rax
0000000100001635         mov        rcx, qword [rbp+var_60]
0000000100001639         lea        rdx, qword [cfstring_Registered]
0000000100001640         lea        rsi, qword [0x100002348]
0000000100001647         mov        r11, qword [0x100002348]
000000010000164e         mov        rbx, qword [rbp+var_28]
0000000100001652         mov        r12, qword [rbp+var_20]
0000000100001656         mov        r13, qword [rbp+var_18]
000000010000165a         mov        r14, qword [rbp+var_10]
000000010000165e         mov        r15, qword [rbp+var_8]
0000000100001662         leave
0000000100001663         jmp        r11
                        ; endp

                     failure:
0000000100001666         mov        rbx, qword [rbp+var_28]
000000010000166a         mov        r12, qword [rbp+var_20]
000000010000166e         mov        r13, qword [rbp+var_18]
0000000100001672         mov        r14, qword [rbp+var_10]
0000000100001676         mov        r15, qword [rbp+var_8]
000000010000167a         leave
000000010000167b         ret
                        ; endp<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>æˆ‘ä»¬å‘ç°è¿™ä¸ªå‡½æ•°æœ‰ä¸€ä¸ªç‰¹ç‚¹ï¼Œä»å¤´å¼€å§‹å¾€ä¸‹ï¼Œä¸€ç›´æ˜¯<code>cmp a, b</code>ç„¶å<code>jne/je failure</code>ï¼Œä¹Ÿå°±æ˜¯è¯´<strong>å¦‚æœæˆ‘ä»¬æš´ç ´ï¼Œè¦æŠŠè¿™äº›<code>jne</code>å’Œ<code>je</code>éƒ½<code>nop</code>æ‰ã€‚</strong>å¤ªéº»çƒ¦äº†ï¼Œä½†æ˜¯ï¼Œè‡ªå·±æƒ³æƒ³ï¼Œå°±çœŸçš„æ²¡æœ‰å¥½æ–¹æ³•å—ï¼Ÿç­”æ¡ˆæ˜¯ï¼šæœ‰çš„ã€‚</p>
<p>åœ¨è¿™é‡Œæˆ‘è€äº†ä¸€ä¸ªå°èªæ˜ï¼šæ—¢ç„¶é‚£ä¹ˆå¤šå¤±è´¥çš„è·¯å¾„éƒ½æŒ‡å‘<code>failure</code>ï¼Œæˆ‘ä½•ä¸æŠŠ<code>failure</code>æœ¬èº«æ”¹ä¸€ä¸‹å‘¢ï¼Ÿ<code>Option+A</code>æ”¹ä¸ºå¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">                     failure:
0000000100001666         jmp        0x10000161e
0000000100001668         nop
000000010000166f         nop
0000000100001670         nop
0000000100001679         nop
000000010000167b         nop<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>æˆ‘è´´ä¸ªå›¾è®©ä½ çœ‹å¾—æ›´æ˜ç™½ï¼š</p>
<p><img src="https://cdn.jsdelivr.net/gh/TLHorse/TLBlogBed@master/2021/02/18/pie-bp-guide.png" alt="pie-bp-guide"></p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œâ€œéªŒè¯å¤±è´¥â€çš„ä»£ç è¢«æˆ‘ä»¬æš´ç ´è·³è½¬åˆ°â€œéªŒè¯æˆåŠŸâ€çš„ä»£ç ã€‚<strong>å¦‚æœå“ªè¡ŒæŒ‡ä»¤è·³è½¬åˆ°â€œéªŒè¯å¤±è´¥â€çš„ä»£ç ï¼Œæˆ‘ä»¬å°±å†è®©å®ƒè·³è½¬åˆ°æˆåŠŸä»£ç ã€‚</strong>å¾ˆå·§å¦™å§ï¼</p>
<p><code>Cmd+Shift+E</code>è¾“å‡ºäºŒè¿›åˆ¶ï¼Œæ›¿æ¢å³å¯ã€‚</p>
<h1 id="Hook"><a href="#Hook" class="headerlink" title="Hook"></a>Hook</h1><h2 id="åˆ†æ-1"><a href="#åˆ†æ-1" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><p>æˆ‘ä»¬å…ˆæ¥è¯•è¯•Hookä¸€ä¸‹è¿™ä¸ªå‡½æ•°ï¼Œæˆ‘å…ˆæŠŠ<code>verifySerial:andName:</code>è´´å‡ºæ¥ã€‚</p>
<pre class="line-numbers language-objc" data-language="objc"><code class="language-objc">&#x2F;* @class PieAppDelegate *&#x2F;
-(void)verifySerial:(void *)arg2 andName:(void *)arg3 &#123;
    var_28 &#x3D; rbx;
    var_20 &#x3D; r12;
    var_18 &#x3D; r13;
    var_10 &#x3D; r14;
    var_8 &#x3D; r15;
    var_60 &#x3D; self;
    r13 &#x3D; arg2;
    r14 &#x3D; arg3;
    r15 &#x3D; (@selector(dataUsingEncoding:))(*qword_100002768, &amp;@selector(dataUsingEncoding:), 0x4, arg3);
    if ((@selector(length))(r13, &amp;@selector(length)) &#x3D;&#x3D; 0x10) &#123;
            rax &#x3D; (@selector(substringToIndex:))(r13, &amp;@selector(substringToIndex:), 0x6);
            rax &#x3D; (@selector(dataUsingEncoding:))(rax, &amp;@selector(dataUsingEncoding:), 0x4);
            r12 &#x3D; (@selector(length))(rax, &amp;@selector(length));
            rax &#x3D; (@selector(bytes))(rax, &amp;@selector(bytes));
            rax &#x3D; MD5(rax, r12, 0x0);
            if (((@selector(isEqualToString:))((@selector(stringWithFormat:))(@class(NSString), &amp;@selector(stringWithFormat:), @&quot;%02X%02X%02X%02X%02X%02X%02X%02X%02X%02X%02X%02X%02X%02X%02X%02X&quot;, *(int8_t *)rax &amp; 0xff, *(int8_t *)(rax + 0x1) &amp; 0xff, *(int8_t *)(rax + 0x2) &amp; 0xff, *(int8_t *)(rax + 0x3) &amp; 0xff, *(int8_t *)(rax + 0x4) &amp; 0xff, *(int8_t *)(rax + 0x5) &amp; 0xff, *(int8_t *)(rax + 0x6) &amp; 0xff, *(int8_t *)(rax + 0x7) &amp; 0xff, *(int8_t *)(rax + 0x8) &amp; 0xff, *(int8_t *)(rax + 0x9) &amp; 0xff, *(int8_t *)(rax + 0xa) &amp; 0xff, *(int8_t *)(rax + 0xb) &amp; 0xff, *(int8_t *)(rax + 0xc) &amp; 0xff), &amp;@selector(isEqualToString:), *qword_100002770) &#x3D;&#x3D; 0x0) &amp;&amp; ((@selector(characterAtIndex:))(r13, &amp;@selector(characterAtIndex:), 0xd) !&#x3D; 0x46)) &#123;
                    rax &#x3D; (@selector(dataUsingEncoding:))(r14, &amp;@selector(dataUsingEncoding:), 0x4);
                    r12 &#x3D; (@selector(length))(rax, &amp;@selector(length));
                    rax &#x3D; (@selector(bytes))(rax, &amp;@selector(bytes));
                    rax &#x3D; MD5(rax, r12, 0x0);
                    if ((@selector(isEqualToString:))((@selector(substringWithRange:))(r13, &amp;@selector(substringWithRange:), 0x6, 0x7), &amp;@selector(isEqualToString:), (@selector(substringToIndex:))((@selector(stringWithFormat:))(@class(NSString), &amp;@selector(stringWithFormat:), @&quot;%02X%02X%02X%02X%02X%02X%02X&quot;, *(int8_t *)rax &amp; 0xff, *(int8_t *)(rax + 0x1) &amp; 0xff, *(int8_t *)(rax + 0x2) &amp; 0xff, *(int8_t *)(rax + 0x3) &amp; 0xff, *(int8_t *)(rax + 0x4) &amp; 0xff, *(int8_t *)(rax + 0x5) &amp; 0xff, *(int8_t *)(rax + 0x6) &amp; 0xff, *(int8_t *)(rax + 0x7) &amp; 0xff), &amp;@selector(substringToIndex:), 0x7)) &#x3D;&#x3D; 0x0) &#123;
                            if ((@selector(isEqualToData:))((@selector(dataUsingEncoding:))((@selector(substringWithRange:))(r13, &amp;@selector(substringWithRange:), 0xe, 0x2), &amp;@selector(dataUsingEncoding:), 0x4), &amp;@selector(isEqualToData:), r15) &#x3D;&#x3D; 0x0) &#123;
                                    (@selector(postNotificationName:object:))((@selector(defaultCenter))(@class(NSNotificationCenter), &amp;@selector(defaultCenter)), &amp;@selector(postNotificationName:object:), @&quot;Registered&quot;, var_60);
                            &#125;
                    &#125;
            &#125;
    &#125;
    return;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>å‡½æ•°ä½“å¾ˆé•¿ï¼Œå…³é”®åœ¨äºå®ƒå¹¶æ²¡æœ‰è¿”å›ä¸€ä¸ªç‰¹å®šçš„å€¼ï¼Œæ¯”å¦‚å¸ƒå°”æˆ–è€…å­—ç¬¦ã€‚è¿™ä¸ªå‡½æ•°æŠŠéªŒè¯å’Œæ³¨å†Œä¸¤ä¸ªè¿‡ç¨‹ç»‘åœ¨ä¸€èµ·ã€‚ä¸€ä¸ªä¸€ä¸ªæŠŠè·³è½¬æ”¹æˆnopï¼Œå¤ªè´¹æ—¶é—´ã€‚é‚£è¿˜æœ‰ä»€ä¹ˆåŠæ³•å‘¢ï¼Ÿæˆ‘çœ‹ç€è¿™ä¸€å±‚å±‚ifåµŒå¥—ï¼Œçªç„¶èŒç”Ÿäº†ä¸€ä¸ªæƒ³æ³•ï¼šä¸ç”¨ä¸€å±‚å±‚æ”¹æ¡ä»¶ï¼Œåªéœ€è¦ä¸€ä¸ªHookï¼Œç›´æ¥æ‰§è¡Œæœ€é‡Œé¢çš„ä»£ç ã€‚</p>
<p>åœ¨è¿™é‡Œæˆ‘ä½¿ç”¨MonkeyDevæ¡†æ¶ï¼Œæ–°å»ºå·¥ç¨‹ï¼Œå°†<code>Pie.app</code>æ‹–å…¥ï¼š</p>
<p><img src="https://cdn.jsdelivr.net/gh/TLHorse/TLBlogBed@master/2021/02/17/pie-proj-guide.png" alt="è¯¦ç»†æ­¥éª¤"></p>
<h2 id="ä»£ç ç¼–å†™"><a href="#ä»£ç ç¼–å†™" class="headerlink" title="ä»£ç ç¼–å†™"></a>ä»£ç ç¼–å†™</h2><p>æŒ‰ç…§Cydia Substrateçš„æ–‡æ¡£ï¼Œæˆ‘ä»¬éœ€è¦åœ¨åŠ¨æ€åº“åŠ è½½å…¥å£ä½œå‡½æ•°æ›¿æ¢ï¼Œéœ€è¦ç”¨<code>MSHookMessageEx</code>ã€‚è¿™é‡Œæ˜¯å®˜æ–¹æ–‡æ¡£çš„ç”¨æ³•ï¼ˆæˆ‘ç¿»è¯‘çš„ï¼‰ï¼š</p>
<pre class="line-numbers language-objc" data-language="objc"><code class="language-objc">void MSHookMessageEx(Class _class, SEL message, IMP hook, IMP *old);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<table>
<thead>
<tr>
<th>å‚æ•°</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody><tr>
<td><code>_class</code></td>
<td>OCç±»ï¼Œæ¶ˆæ¯å°†åœ¨è¯¥ç±»ä¸Šè¢«hookã€‚è¿™ä¸ªç±»å¯ä»¥æ˜¯ä¸€ä¸ªå…ƒç±»ï¼Œè¿™æ ·å°±å¯ä»¥hookä½éå®ä¾‹æˆ–ç±»æ¶ˆæ¯ã€‚</td>
</tr>
<tr>
<td><code>message</code></td>
<td>è¢«hookçš„OCé€‰æ‹©å™¨ï¼ˆselï¼‰ã€‚è¿™å¯ä»¥ç”¨ <code>@selector</code> ï¼Œæˆ–åœ¨è¿è¡Œæ—¶ç”¨ <code>sel_registerName</code>ç”Ÿæˆã€‚</td>
</tr>
<tr>
<td><code>hook</code></td>
<td><code>message</code>çš„æ›¿ä»£å‡½æ•°ï¼ŒIMPæŒ‡é’ˆç±»å‹ã€‚(æ³¨æ„ä¼ å…¥çš„æ—¶å€™ä¸€å®šæ˜¯æŒ‡é’ˆ)</td>
</tr>
<tr>
<td><code>old</code></td>
<td>ä¸€ä¸ªç©ºçš„å‡½æ•°æŒ‡é’ˆã€‚è¿™ä¸ªç©ºçš„å‡½æ•°æŒ‡é’ˆåœ¨hookæ—¶ä¼šè¢«åŸå‡½æ•°å¡«å……ï¼Œè¿™æ ·ä½ åœ¨å†™æ–°å‡½æ•°çš„æ—¶å€™ï¼Œå°±å¯ä»¥è°ƒç”¨åŸå‡½æ•°ä½“äº†ã€‚å¦‚æœä½ ä¸éœ€è¦è°ƒç”¨åŸå‡½æ•°ï¼Œæ­¤å¤„å¯ä»¥ç•™æˆNULLã€‚</td>
</tr>
</tbody></table>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬ç¼–è¾‘<code>PieTweak.m</code>ï¼Œç¼–è¾‘<code>constructor</code>ï¼š</p>
<pre class="line-numbers language-objc" data-language="objc"><code class="language-objc">static void __attribute__((constructor)) initialize(void) &#123;
    MSHookMessageEx(objc_getClass(&quot;PieAppDelegate&quot;), @selector(verifySerial:andName:), (IMP)&amp;new_PieAppDelegate_verifySerial, NULL);
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>å…¶ä¸­<code>new_PieAppDelegate_verifySerial</code>æ˜¯æˆ‘ä»¬è¦å®ç°çš„ã€‚æˆ‘ä»¬å¯ä»¥å†™ä¸€ä¸ª<code>origin_PieAppDelegate_verifySerial</code>ã€‚ç”±äºæˆ‘ä»¬ä¸éœ€è¦åœ¨hooké‡Œè°ƒç”¨åŸå‡½æ•°ï¼Œæ‰€ä»¥ç•™ç©ºå¡«<code>NULL</code>ã€‚</p>
<p>æ¥ä¸‹æ¥å°±è¯¥å†™æˆ‘ä»¬çš„æ›¿ä»£å‡½æ•°ä½“äº†ï¼Œ<code>new_PieAppDelegate_verifySerial</code>ã€‚<strong>æˆ‘ä»¬é¦–å…ˆå¾—è€ƒè™‘ä¸€ä¸‹å‚æ•°åˆ—è¡¨</strong>ï¼Œé™¤äº†Hopperè§£æå‡ºçš„<code>serial</code>å’Œ<code>name</code>ï¼Œ<strong>è¿˜æœ‰ä¸¤ä¸ªå›ºå®šå‚æ•°ï¼š<code>self</code>å’Œ<code>_cmd</code>ã€‚</strong></p>
<pre class="line-numbers language-objc" data-language="objc"><code class="language-objc">@class PieAppDelegate; &#x2F;&#x2F; ä¸ºäº†åœ¨å‚æ•°ä¸­å†™selfï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬å£°æ˜ç±»

static void new_PieAppDelegate_verifySerial(
    PieAppDelegate* self, &#x2F;&#x2F; ä¸¤ä¸ªå›ºå®šå‚æ•°
    SEL _cmd, 
    void *serial, &#x2F;&#x2F; æ­¤å¤„å¤åˆ¶ç²˜è´´Hopper
    void *name
) &#123;
    &#x2F;&#x2F; ...
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>é‚£ä¹ˆå‡½æ•°ä½“å‘¢ï¼Ÿ</strong>è¿™å¾—æ ¹æ®Hopperçš„ä¼ªä»£ç è¿›è¡Œè¿˜åŸã€‚ä¼ªä»£ç æœ€å†…å±‚æœ‰è¿™ä¹ˆä¸€å¥ï¼š</p>
<pre class="line-numbers language-objc" data-language="objc"><code class="language-objc">(@selector(postNotificationName:object:))((@selector(defaultCenter))(@class(NSNotificationCenter), &amp;@selector(defaultCenter)), &amp;@selector(postNotificationName:object:), @&quot;Registered&quot;, var_60);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>æˆ‘ä»¬å¯ä»¥æ¨æµ‹å‡ºï¼š</p>
<pre class="line-numbers language-objc" data-language="objc"><code class="language-objc">[NSNotificationCenter.defaultCenter postNotificationName:@&quot;Registered&quot; object:self];<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>æŠŠè¿˜åŸçš„è¯­å¥æ”¾åˆ°<code>new_PieAppDelegate_verifySerial</code>é‡Œã€‚</p>
<p>ç°åœ¨å¤§å®¶å¯èƒ½è¢«æˆ‘ç»•çš„æœ‰ç‚¹æ™•ï¼Œæ‰€æœ‰çš„ä»£ç çºµè§‚å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-objc" data-language="objc"><code class="language-objc">#import &quot;PieTweak.h&quot;
#import &quot;substrate.h&quot;

@class PieAppDelegate;

static void new_PieAppDelegate_verifySerial(PieAppDelegate* self, SEL _cmd, void *serial, void *name) &#123;
    [NSNotificationCenter.defaultCenter postNotificationName:@&quot;Registered&quot; object:self]; &#x2F;&#x2F; æˆ‘ä»¬ä»ä¼ªä»£ç è¿˜åŸçš„è¯­å¥
&#125;

static void __attribute__((constructor)) initialize(void) &#123;
    MSHookMessageEx(objc_getClass(&quot;PieAppDelegate&quot;), @selector(verifySerial:andName:), (IMP)&amp;new_PieAppDelegate_verifySerial, NULL);
    &#x2F;&#x2F; è°ƒç”¨substrateè¿›è¡Œhook
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>Cmd+B</code>ç¼–è¯‘ï¼ŒMonkeyDevä¼šè‡ªåŠ¨ç»™æˆ‘ä»¬æ³¨å…¥ï¼š</p>
<p><img src="https://cdn.jsdelivr.net/gh/TLHorse/TLBlogBed@master/2021/02/17/pie-hook-success.png" alt="pie-hook-success"></p>
<p><strong>ä¸é”™å§ï¼ä¸€æ‰“å¼€å°±æ³¨å†Œå¥½äº†ã€‚</strong>æˆ‘ä»¬åªéœ€è¦æŠŠ<code>Pie.app</code>ä»<code>TargetApp</code>é‡Œé¢æ‹–å‡ºå»ï¼Œå°±æ˜¯æˆ‘ä»¬çš„æˆå“å•¦ï¼</p>
<h1 id="æ³¨å†Œæœºç¼–å†™"><a href="#æ³¨å†Œæœºç¼–å†™" class="headerlink" title="æ³¨å†Œæœºç¼–å†™"></a>æ³¨å†Œæœºç¼–å†™</h1><p>å¦‚æœä¸ç”¨hookæš´ç ´ï¼Œé‚£å°±æ˜¯å†™æ³¨å†Œæœºäº†ã€‚æ³¨å†Œæœºä½¿æˆ‘ä»¬ç ´è§£å¾—æ›´ä¼˜é›…ï¼Œä½†æ˜¯ä»£ç çš„åˆ†ææ›´éº»çƒ¦ã€‚è¿™ä¸ªCMä¸æ˜¯æœ‰åè°ƒè¯•å—ï¼Œæ‰€ä»¥è¯´åªæœ‰é æˆ‘ä»¬çœ‹ä¼ªä»£ç äº†ã€‚</p>
<p>è¿™é‡Œå¸Œæœ›æé†’å¤§å®¶å‡ ç‚¹ï¼š</p>
<ul>
<li>çœ‹ä¼ªä»£ç é¦–å…ˆè¦<strong>åˆ©ç”¨HopperåŠŸèƒ½</strong>ï¼ŒæŠŠarg2ã€arg3è¿™æ ·çš„æ— æ„ä¹‰å‚æ•°åæ›´åï¼Œæ¯”å¦‚<code>serial</code>å’Œ<code>name</code>ï¼›</li>
<li>ä¸€å®šè¦å–„äºè¿›è¡Œ<strong>ä»£ç è¿˜åŸ</strong>ã€‚Hopperä¼šæŠŠä¸çŸ¥é“çš„æ–¹æ³•éƒ½ç¿»è¯‘æˆ<code>@selector</code>ï¼Œè¯­æ³•éå¸¸çš„åˆ«æ‰­ã€‚å…·ä½“çš„è¿˜åŸæ–¹æ³•hookä¸­æœ‰æ‰€æ¶‰åŠï¼Œä½†æ˜¯æˆ‘ä¼šåœ¨æ–‡æœ«å•ç‹¬æˆèŠ‚ï¼›</li>
<li>åœ¨è‡ªå·±é‡å†™ä»£ç æ—¶ï¼Œ<strong>ä½¿ç”¨è‡ªå·±çš„å˜é‡</strong>ï¼Œè€Œä¸æ˜¯<code>r12</code>ã€<code>r13</code>è¿™æ ·çš„æ— æ„ä¹‰å˜é‡ï¼›</li>
<li>æœ‰æ—¶å€™Hopperä¼šæŠŠä»£ç é€»è¾‘è§£æå¾—å¾ˆéº»çƒ¦ï¼Œæ¯”å¦‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå®ƒæŠŠMD5çš„<em>åŠ å¯†æ•°æ®</em>å’Œ<em>è½¬æ¢æˆå­—ç¬¦ä¸²çš„MD5</em>åˆ†åˆ«æ”¾åœ¨å˜é‡å’Œifæ¡ä»¶é‡Œï¼Œå°±ä¼šè®©ä½ æ„Ÿè§‰æ‘¸ä¸ç€å¤´ï¼Œæ‰€ä»¥è¯´<strong>ä¸€å®šè¦æœ‰è‡ªä¸»åˆ¤æ–­èƒ½åŠ›ã€‚</strong></li>
</ul>
<h2 id="ä»£ç åˆ†æ"><a href="#ä»£ç åˆ†æ" class="headerlink" title="ä»£ç åˆ†æ"></a>ä»£ç åˆ†æ</h2><p>æˆ‘ä»¬é¦–å…ˆæŠŠéªŒè¯å‡½æ•°çš„æµç¨‹æ£è…¾æ¸…æ¥šï¼š</p>
<pre class="line-numbers language-objc" data-language="objc"><code class="language-objc">var_28 &#x3D; rbx; &#x2F;&#x2F; å®šä¹‰ä¸€å †æ²¡ç”¨çš„ï¼Œä¸è¿‡ä¸€å®šè¦æ¸…æ¥š
var_20 &#x3D; r12;
var_18 &#x3D; r13;
var_10 &#x3D; r14;
var_8 &#x3D; r15;
var_60 &#x3D; self;
r13 &#x3D; arg2; &#x2F;&#x2F; serialåºåˆ—å·å˜é‡
r14 &#x3D; arg3; &#x2F;&#x2F; nameåç§°å˜é‡
r15 &#x3D; (@selector(dataUsingEncoding:))(*qword_100002768, &amp;@selector(dataUsingEncoding:), 0x4, arg3); &#x2F;&#x2F; æŠŠåç§°è¿›è¡Œç¼–ç ï¼Œ4å…¶å®æ˜¯NSStringEncodingçš„NSUTF8StringEncodingï¼Œæ˜¯ä¸ªå¸¸é‡<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ä¸€å¼€å¤´ï¼Œå®šä¹‰äº†ä¸€å †æ²¡ç”¨çš„ï¼Œä¸è¿‡è¦æ¸…æ¥šr13å’Œr14æ˜¯<code>serial</code>å’Œnameã€‚r15å¤„æŠŠ<code>name</code>ç¼–ç ï¼ŒæŸ¥å¼€å‘è€…æ–‡æ¡£å¯çŸ¥0x4å…¶å®æ˜¯<code>NSStringEncoding</code>çš„NSUTF8StringEncodingï¼Œæ˜¯ä¸ªå¸¸é‡ã€‚</p>
<pre class="line-numbers language-objc" data-language="objc"><code class="language-objc">if ((@selector(length))(r13, &amp;@selector(length)) &#x3D;&#x3D; 0x10) &#123;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>åˆ¤æ–­serialçš„é•¿åº¦ï¼Œå¦‚æœæ˜¯16ä½ï¼ˆ0x10ï¼‰ï¼Œé€šè¿‡ã€‚</p>
<pre class="line-numbers language-objc" data-language="objc"><code class="language-objc">rax &#x3D; (@selector(substringToIndex:))(r13, &amp;@selector(substringToIndex:), 0x6); &#x2F;&#x2F; å–åºåˆ—å·å‰6ä½
rax &#x3D; (@selector(dataUsingEncoding:))(rax, &amp;@selector(dataUsingEncoding:), 0x4);
r12 &#x3D; (@selector(length))(rax, &amp;@selector(length)); &#x2F;&#x2F; è®¡ç®—é•¿åº¦
rax &#x3D; (@selector(bytes))(rax, &amp;@selector(bytes)); &#x2F;&#x2F; è®¡ç®—å­—èŠ‚
rax &#x3D; MD5(rax, r12, 0x0); &#x2F;&#x2F; è®¡ç®—åºåˆ—å·å‰6ä½çš„MD5å€¼<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>è¿™5è¡Œä»£ç å…ˆå–åºåˆ—å·å‰6ä½ï¼Œç„¶åè®¡ç®—å‡ºäº†ç›¸å…³é•¿åº¦ã€å­—èŠ‚ï¼Œæœ€åè®¡ç®—å‡ºåºåˆ—å·å‰6ä½çš„MD5ã€‚</p>
<pre class="line-numbers language-objc" data-language="objc"><code class="language-objc">if (((@selector(isEqualToString:))((@selector(stringWithFormat:))(@class(NSString), &amp;@selector(stringWithFormat:), @&quot;%02X%02X%02X%02X%02X%02X%02X%02X%02X%02X%02X%02X%02X%02X%02X%02X&quot;, *(int8_t *)rax &amp; 0xff, *(int8_t *)(rax + 0x1) &amp; 0xff, *(int8_t *)(rax + 0x2) &amp; 0xff, *(int8_t *)(rax + 0x3) &amp; 0xff, *(int8_t *)(rax + 0x4) &amp; 0xff, *(int8_t *)(rax + 0x5) &amp; 0xff, *(int8_t *)(rax + 0x6) &amp; 0xff, *(int8_t *)(rax + 0x7) &amp; 0xff, *(int8_t *)(rax + 0x8) &amp; 0xff, *(int8_t *)(rax + 0x9) &amp; 0xff, *(int8_t *)(rax + 0xa) &amp; 0xff, *(int8_t *)(rax + 0xb) &amp; 0xff, *(int8_t *)(rax + 0xc) &amp; 0xff), &amp;@selector(isEqualToString:), *qword_100002770) &#x3D;&#x3D; 0x0) &amp;&amp; ((@selector(characterAtIndex:))(r13, &amp;@selector(characterAtIndex:), 0xd) !&#x3D; 0x46)) &#123; &#x2F;&#x2F; è¿™ä¸ªifçš„æ¡ä»¶è¦æ»¡è¶³ä¸¤éƒ¨åˆ†ï¼š1. åºåˆ—å·çš„å‰6ä½çš„MD5æ˜¯66EAD6FE7CBE7987B7C4B1A1EED0E5A5ï¼›2. åºåˆ—å·çš„ç¬¬13ä½æ˜¯ASCII 0x46ï¼Œä¹Ÿå°±æ˜¯å­—ç¬¦F<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>è¿™ä¸ªæ¡ä»¶å¾ˆé•¿ï¼Œä½†æ˜¯ç»†å¿ƒçš„ä½ ä¼šå‘ç°ä¸­é—´æœ‰ä¸ªé€»è¾‘è¿ç®—<code>&amp;&amp;</code>ï¼Œæ¡ä»¶åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š</p>
<ol>
<li>åºåˆ—å·çš„å‰6ä½çš„MD5æ˜¯<code>66EAD6FE7CBE7987B7C4B1A1EED0E5A5</code>ï¼Œé€šè¿‡æŸç½‘ç«™çš„åæŸ¥å¾—çŸ¥æ˜¯â€œKRACK-â€ï¼Œè¿™æ˜¯ä¸ªåºåˆ—å·å‰ç¼€ï¼›</li>
<li>åºåˆ—å·çš„ç¬¬13ä½æ˜¯ASCII 0x46ï¼Œä¹Ÿå°±æ˜¯å­—ç¬¦Fã€‚</li>
</ol>
<pre class="line-numbers language-objc" data-language="objc"><code class="language-objc">rax &#x3D; (@selector(dataUsingEncoding:))(r14, &amp;@selector(dataUsingEncoding:), 0x4); &#x2F;&#x2F; ç¼–ç name
r12 &#x3D; (@selector(length))(rax, &amp;@selector(length)); &#x2F;&#x2F; è®¡ç®—nameé•¿åº¦
rax &#x3D; (@selector(bytes))(rax, &amp;@selector(bytes)); &#x2F;&#x2F; è®¡ç®—nameå­—èŠ‚
rax &#x3D; MD5(rax, r12, 0x0); &#x2F;&#x2F; ä½¿ç”¨MD5åŠ å¯†name<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>è¿™ä¸ªå’Œåˆšæ‰ä»£ç åˆ†æä¸­ç¬¬äºŒä¸ªä»£ç æ¡†ä¸­çš„5è¡Œç»“æ„æ˜¯ä¸€æ¨¡ä¸€æ ·ï¼Œè®¡ç®—nameå±æ€§ï¼Œç„¶ååŠ å¯†nameã€‚</p>
<pre class="line-numbers language-objc" data-language="objc"><code class="language-objc">if ((@selector(isEqualToString:))((@selector(substringWithRange:))(r13, &amp;@selector(substringWithRange:), 0x6, 0x7), &amp;@selector(isEqualToString:), (@selector(substringToIndex:))((@selector(stringWithFormat:))(@class(NSString), &amp;@selector(stringWithFormat:), @&quot;%02X%02X%02X%02X%02X%02X%02X&quot;, *(int8_t *)rax &amp; 0xff, *(int8_t *)(rax + 0x1) &amp; 0xff, *(int8_t *)(rax + 0x2) &amp; 0xff, *(int8_t *)(rax + 0x3) &amp; 0xff, *(int8_t *)(rax + 0x4) &amp; 0xff, *(int8_t *)(rax + 0x5) &amp; 0xff, *(int8_t *)(rax + 0x6) &amp; 0xff, *(int8_t *)(rax + 0x7) &amp; 0xff), &amp;@selector(substringToIndex:), 0x7)) &#x3D;&#x3D; 0x0) &#123;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>åˆæ˜¯ä¸€é•¿ä¸²æ¡ä»¶ï¼Œå¥½åƒæ˜¯åœ¨åˆ¤æ–­serialçš„æŸä¸ªå­å­—ç¬¦ä¸²ï¼ˆä¹Ÿå°±æ˜¯æŸéƒ¨åˆ†ï¼‰è·Ÿnameçš„md5å€¼ç›¸ç­‰ã€‚</p>
<p>è¿™é‡Œè¦è¯´æ˜ä¸€ä¸‹<code>substringWithRange:</code>çš„å‚æ•°ï¼Œç ”ç©¶äº†åŠå¤©å‘ç°ï¼Œ0x6è¡¨ç¤ºå­å­—ç¬¦ä¸²å¼€å§‹ï¼Œ<strong>0x7è¡¨ç¤ºåŒ…å«å¼€å¤´å¾€åæ•°ä¸ƒä½ï¼Œæ˜¯å­å­—ç¬¦ä¸²çš„é•¿åº¦</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªå‡½æ•°è¿”å›çš„æ˜¯serialçš„6åˆ°12ä½ï¼ˆæˆ‘è¿™é‡ŒæŒ‡çš„æ˜¯ç´¢å¼•ï¼‰ã€‚ç›¸å½“äºè¿™ä¸ªifæ¡ä»¶åœ¨å°†nameçš„md5å€¼ä¸serialçš„6-12ä½å¯¹æ¯”ã€‚</p>
<pre class="line-numbers language-objc" data-language="objc"><code class="language-objc">if ((@selector(isEqualToData:))((@selector(dataUsingEncoding:))((@selector(substringWithRange:))(r13, &amp;@selector(substringWithRange:), 0xe, 0x2), &amp;@selector(dataUsingEncoding:), 0x4), &amp;@selector(isEqualToData:), r15) &#x3D;&#x3D; 0x0) &#123;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>åˆæ˜¯ä¸€ä¸ªifã€‚ç°åœ¨æˆ‘ä»¬ä¸€ç›®äº†ç„¶ï¼Œè¿™æ˜¯åœ¨æŠŠserialç´¢å¼•ä¸º14ã€15çš„å­å­—ç¬¦ä¸²ç¼–ç åå’Œr15å¯¹æ¯”ã€‚è¯¶ï¼Ÿr15ä¸æ˜¯nameçš„utf8ç¼–ç å—ï¼Ÿä¸å¯¹å•Šï¼Ÿä¸¤ä½å’Œä¸€é•¿ä¸²åç§°å¯¹æ¯”ï¼Œè‚¯å®šè¿”å›falseã€‚åˆ«ç€æ€¥ï¼Œæˆ‘ä»¬ç§ç§ASMï¼š</p>
<pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">                     -[PieAppDelegate verifySerial:andName:]:
0000000100001342         push       rbp
0000000100001343         mov        rbp, rsp
0000000100001346         mov        qword [rbp+var_28], rbx
000000010000134a         mov        qword [rbp+var_20], r12
000000010000134e         mov        qword [rbp+var_18], r13
0000000100001352         mov        qword [rbp+var_10], r14
0000000100001356         mov        qword [rbp+var_8], r15
000000010000135a         sub        rsp, 0xd0
0000000100001361         mov        qword [rbp+var_60], rdi
0000000100001365         mov        r13, rdx
0000000100001368         mov        r14, rcx
000000010000136b         mov        rdi, qword [qword_100002768]                ; qword_100002768
0000000100001372         mov        edx, 0x4
0000000100001377         lea        rsi, qword [0x1000022b8]                    ; &amp;@selector(dataUsingEncoding:)
000000010000137e         call       qword [0x1000022b8]                         ; @selector(dataUsingEncoding:)
0000000100001384         mov        r15, rax
0000000100001387         lea        rsi, qword [0x1000022c8]                    ; &amp;@selector(length)
000000010000138e         mov        rdi, r13
0000000100001391         call       qword [0x1000022c8]                         ; @selector(length)
0000000100001397         cmp        rax, 0x10
000000010000139b         jne        loc_100001666<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>æˆ‘ä»¬å‘ç°ï¼Œå‡½æ•°çš„å¼€å¤´ï¼Œç«Ÿç„¶æœ‰ä¸€ä¸ªæˆ‘ä»¬å¿½ç•¥äº†çš„<code>qword_100002768</code>ï¼è·³è½¬ä¸€ä¸‹ï¼Œå‘ç°å®ƒæŒ‡å‘ä¸€ä¸ªâ€œBCâ€çš„å­—ç¬¦ä¸²ï¼š</p>
<pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">    qword_100002768:
0000000100002768 dq 0x0000000100002168 ; @&quot;BC&quot;, DATA XREF&#x3D;-[PieAppDelegate verifySerial:andName:]+41<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>é‚£ä¸ºä»€ä¹ˆè¯´è¿™ä¸ªqwordæ˜¯r15å‘¢ï¼Ÿå› ä¸ºåæ±‡ç¼–ä¸­ï¼Œä»rdiè¢«èµ‹å€¼åˆ°è¢«è¦†ç›–æœŸé—´ï¼Œåªæœ‰raxä¼ ç»™äº†r15ã€‚æˆ‘ä»¬æ¨æµ‹BCå°±æ˜¯serialç´¢å¼•ä¸º14ã€15çš„å­å­—ç¬¦ä¸²ã€‚</p>
<p>å›åˆ°ä»£ç åˆ†æï¼Œæœ€åä¸€ä¸ªifåµŒå¥—çš„å°±æ˜¯æˆåŠŸçš„å¼¹çª—äº†ã€‚</p>
<h2 id="æµç¨‹å¤ç°"><a href="#æµç¨‹å¤ç°" class="headerlink" title="æµç¨‹å¤ç°"></a>æµç¨‹å¤ç°</h2><p>æˆ‘ä»¬æŠŠä¸Šé¢çš„ä¼ªä»£ç ç”¨Swift 5 100%é‡å†™ä¸€ä¸‹ï¼Œä¸ä½œä¿®æ”¹ã€‚å…ˆå®ç°ä¸¤ä¸ªå­—ç¬¦ä¸²æ‰©å±•ï¼ŒMD5æ–¹æ³•å’Œ<code>characterAtIndex</code>ï¼š</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift">extension String &#123;
    &#x2F;&#x2F; è·å¾—å­—ç¬¦ä¸²åœ¨ç´¢å¼•å¤„çš„å­—ç¬¦
    func characterAtIndex(index: Int) -&gt; Character? &#123;
        var cur &#x3D; 0
        for char in self &#123;
            if cur &#x3D;&#x3D; index &#123;
                return char
            &#125;
            cur +&#x3D; 1
        &#125;
        return nil
    &#125;
    var md5: String &#123;
        let utf8 &#x3D; cString(using: .utf8)
        var digest &#x3D; [UInt8](repeating: 0, count: Int(CC_MD5_DIGEST_LENGTH))
        CC_MD5(utf8, CC_LONG(utf8!.count - 1), &amp;digest) &#x2F;&#x2F; è®°å¾—import CommonCrypto
        return digest.reduce(&quot;&quot;) &#123; $0 + String(format: &quot;%02X&quot;, $1) &#125;
    &#125;
    &#x2F;&#x2F; è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡xxx.md5çš„æ–¹å¼åŠ å¯†äº†ï¼Œéå¸¸ä¾¿æ·
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>å†å†™éªŒè¯å‡½æ•°ï¼š</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift">func verifySerial(_ serial: String, name: String) &#123;
    let encodedName &#x3D; name.data(using: .utf8)
    if serial.count &#x3D;&#x3D; 16 &#123;
        let processedSerial &#x3D; String(serial.prefix(6))
        &#x2F;&#x2F; let processedSerialData &#x3D; NSData(data: processedSerial.data(using: .utf8)!)
        &#x2F;&#x2F; let snLength &#x3D; processedSerialData.count
        &#x2F;&#x2F; let snBytes &#x3D; processedSerialData.bytes &#x2F;&#x2F; è®¡ç®—ç›¸å…³å€¼
        &#x2F;&#x2F; let md5val &#x3D; MD5(snBytes, snLength, 0x0); &#x2F;&#x2F; MD5 encryption
        &#x2F;&#x2F; æœ‰äº†æˆ‘ä»¬çš„md5å‡½æ•°ä¸Šé¢çš„è®¡ç®—éƒ½ä¸éœ€è¦äº†
        var md5str &#x3D; processedSerial.md5
        
        if processedSerial.md5.uppercased() &#x3D;&#x3D; &quot;66EAD6FE7CBE7987B7C4B1A1EED0E5A5&quot; &amp;&amp; serial.characterAtIndex(index: 13) &#x3D;&#x3D; &quot;F&quot; &#123;
            &#x2F;&#x2F; md5val &#x3D; [name dataUsingEncoding:NSUTF8StringEncoding];
            &#x2F;&#x2F; md5vallen &#x3D; [md5val length]; &#x2F;&#x2F; è®¡ç®—ç›¸å…³å€¼
            &#x2F;&#x2F; md5valbytes &#x3D; [md5valbytes bytes];
            &#x2F;&#x2F; md5OfMd5val &#x3D; MD5(md5valbytes, md5vallen, 0x0);
            &#x2F;&#x2F; ä¸Šé¢çš„å…¨éƒ½ä¸éœ€è¦äº†
            
            &#x2F;&#x2F; åˆ›å»ºä¸€äº›ç´¢å¼•ï¼Œæ–¹ä¾¿æˆ‘ä»¬æˆªå–å­—ç¬¦ä¸²
            let index6 &#x3D; serial.index(serial.startIndex, offsetBy: 6)
            let index12 &#x3D; serial.index(serial.startIndex, offsetBy: 12)
            let index14 &#x3D; serial.index(serial.startIndex, offsetBy: 14)
            let index15 &#x3D; serial.index(serial.startIndex, offsetBy: 15)
            if name.md5.prefix(7) &#x3D;&#x3D; serial[index6...index12] &#123; &#x2F;&#x2F; prefixç”¨æ¥å–å‰7ä½
                if serial[index14...index15] &#x3D;&#x3D; &quot;BC&quot; &#123;
                    &#x2F;&#x2F; Registered
                    &#x2F;&#x2F; (@selector(postNotificationName:object:))((@selector(defaultCenter))(@class(NSNotificationCenter), &amp;@selector(defaultCenter)), &amp;@selector(postNotificationName:object:), @&quot;Registered&quot;, var_60);
                    print(&quot;Registered! &quot;)
                &#125;
            &#125;
        &#125;
    &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ä¸Šé¢çš„ifæœ‰ç‚¹å¤šï¼Œæˆ‘ä»¬å†ä»¥ç»å…¸Swifté£æ ¼å†™ä¸€æ‰‹ä¼˜é›…çš„ä»£ç ï¼Œè®©å®ƒè¿”å›ä¸€ä¸ªå€¼ï¼š</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift">func verifySerial(_ serial: String, name: String) -&gt; Bool &#123;
    guard serial.count &#x3D;&#x3D; 16 else &#123; return false &#125;
    
    let processedSerial &#x3D; String(serial.prefix(6))
    guard processedSerial &#x3D;&#x3D; &quot;KRACK-&quot; else &#123; return false &#125;
    guard serial.characterAtIndex(index: 13) &#x3D;&#x3D; &quot;F&quot; else &#123; return false &#125;
    
    let index6 &#x3D; serial.index(serial.startIndex, offsetBy: 6)
    let index12 &#x3D; serial.index(serial.startIndex, offsetBy: 12)
    let index14 &#x3D; serial.index(serial.startIndex, offsetBy: 14)
    let index15 &#x3D; serial.index(serial.startIndex, offsetBy: 15)
    
    guard serial[index6...index12] &#x3D;&#x3D; name.md5.prefix(7).uppercased() else &#123; return false &#125;
    guard serial[index14...index15] &#x3D;&#x3D; &quot;BC&quot; else &#123; return false &#125;
    
    return true
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p><code>guard &lt;statement&gt; else &#123;&#125;</code>çš„ä½œç”¨æ˜¯ï¼Œç¡®ä¿<code>&lt;statement&gt;</code>ä¸ºçœŸï¼Œå¦åˆ™æ‰§è¡Œ<code>else</code>ä»£ç å—ã€‚</p>
</blockquote>
<h2 id="åºåˆ—å·ç”Ÿæˆ"><a href="#åºåˆ—å·ç”Ÿæˆ" class="headerlink" title="åºåˆ—å·ç”Ÿæˆ"></a>åºåˆ—å·ç”Ÿæˆ</h2><p>æœ‰äº†éªŒè¯å‡½æ•°åšåŸºç¡€ï¼Œæˆ‘ä»¬å°±çŸ¥é“ä»€ä¹ˆæ ·çš„SNèƒ½è¢«<code>verifySerial</code>æ¥å—ã€‚æ ¼å¼æ˜¯ï¼š<code>KRACK-&lt;ç”¨æˆ·åçš„md5å€¼å–å‰7ä½&gt;FBC</code>ã€‚å†™ä¸€ä¸ªKeygenï¼Œè¶…çº§ç®€å•ã€‚</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift">func generateSerial(from name: String) -&gt; String &#123;
    let nameMD5 &#x3D; name.md5.prefix(7).uppercased()
    return &quot;KRACK-\(nameMD5)FBC&quot;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>æœç„¶æ˜¯ç ´è§£å®¹æ˜“åˆ†æéš¾å•Šï¼</p>
<h2 id="å®Œå–„æ³¨å†Œæœº"><a href="#å®Œå–„æ³¨å†Œæœº" class="headerlink" title="å®Œå–„æ³¨å†Œæœº"></a>å®Œå–„æ³¨å†Œæœº</h2><p>å®Œå–„æ³¨å†Œæœºï¼ŒæŠŠæˆ‘ä»¬çš„Keygenåšæˆå‘½ä»¤è¡Œå½¢å¼ï¼Œæœ‰<code>-gv</code>ä¸¤ä¸ªåŠŸèƒ½ï¼Œgæ˜¯ç”Ÿæˆæ¨¡å¼ï¼Œvæ˜¯éªŒè¯æ¨¡å¼ã€‚</p>
<p>å…¨éƒ¨ä»£ç <code>main.c</code>ï¼š</p>
<pre class="line-numbers language-swift" data-language="swift"><code class="language-swift">import Foundation
import CommonCrypto

func verifySerial(_ serial: String, name: String) -&gt; Bool &#123;
    guard serial.count &#x3D;&#x3D; 16 else &#123; return false &#125;
    let processedSerial &#x3D; String(serial.prefix(6))
    guard processedSerial &#x3D;&#x3D; &quot;KRACK-&quot; else &#123; return false &#125;
    guard serial.characterAtIndex(index: 13) &#x3D;&#x3D; &quot;F&quot; else &#123; return false &#125;
    let index6 &#x3D; serial.index(serial.startIndex, offsetBy: 6)
    let index12 &#x3D; serial.index(serial.startIndex, offsetBy: 12)
    let index14 &#x3D; serial.index(serial.startIndex, offsetBy: 14)
    let index15 &#x3D; serial.index(serial.startIndex, offsetBy: 15)
    guard name.md5.prefix(7).uppercased() &#x3D;&#x3D; serial[index6...index12] else &#123; return false &#125;
    guard serial[index14...index15] &#x3D;&#x3D; &quot;BC&quot; else &#123; return false &#125;
    return true
&#125;

func generateSerial(from name: String) -&gt; String &#123;
    let nameMD5 &#x3D; name.md5.prefix(7).uppercased()
    return &quot;KRACK-\(nameMD5)FBC&quot;
&#125;

func askAndGenerate() &#123;
    print(&quot;Username:&quot;, terminator: &quot; &quot;)
    if let uname &#x3D; readLine() &#123;
        print(&quot;Serial: \(generateSerial(from: uname))&quot;)
    &#125;
    print(&quot;-----------------------&quot;)
    askAndGenerate()
&#125;

func askAndValidate() &#123;
    print(&quot;Username:&quot;, terminator: &quot; &quot;)
    if let uname &#x3D; readLine() &#123;
        print(&quot;Serial:&quot;, terminator: &quot; &quot;)
        if let sn &#x3D; readLine() &#123;
            let result &#x3D; verifySerial(sn, name: uname)
            print(result ? &quot;Serial is valid.&quot; : &quot;Serial is invalid.&quot;)
        &#125;
    &#125;
    print(&quot;-----------------------&quot;)
    askAndValidate()
&#125;

print(&quot;Keygen of Pie.app - by @TLHorse from www.52pojie.cn&quot;)

let argv &#x3D; ProcessInfo.processInfo.arguments
guard argv.count &#x3D;&#x3D; 2 else &#123;
    for i in argv &#123;print(i)&#125;
    print(&quot;PieKeygen: error: 2 arguments is needed&quot;)
    exit(1)
&#125;
switch argv[1] &#123;
case &quot;-g&quot;:
    print(&quot;--- Generation mode ---&quot;)
    askAndGenerate()
case &quot;-v&quot;:
    print(&quot;--- Validation mode ---&quot;)
    askAndValidate()
default:
    print(&quot;PieKeygen: error: illegal operand\nusage: PieKeygen [-gv]&quot;)
&#125;

extension String &#123;
    func characterAtIndex(index: Int) -&gt; Character? &#123;
        var cur &#x3D; 0
        for char in self &#123;
            if cur &#x3D;&#x3D; index &#123;
                return char
            &#125;
            cur +&#x3D; 1
        &#125;
        return nil
    &#125;
    var md5: String &#123;
        let utf8 &#x3D; cString(using: .utf8)
        var digest &#x3D; [UInt8](repeating: 0, count: Int(CC_MD5_DIGEST_LENGTH))
        CC_MD5(utf8, CC_LONG(utf8!.count - 1), &amp;digest)
        return digest.reduce(&quot;&quot;) &#123; $0 + String(format:&quot;%02X&quot;, $1) &#125;
    &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/TLHorse/TLBlogBed@master/2021/02/17/pie-kg-product.png" alt="pie-kg-product"></p>
<h1 id="åˆ°åº•å¦‚ä½•è¿˜åŸä»£ç "><a href="#åˆ°åº•å¦‚ä½•è¿˜åŸä»£ç " class="headerlink" title="åˆ°åº•å¦‚ä½•è¿˜åŸä»£ç "></a>åˆ°åº•å¦‚ä½•è¿˜åŸä»£ç </h1><p>å¦‚ä½•æŠŠHopperçš„ä¼ªä»£ç å°½å¯èƒ½è¿˜åŸæˆçœŸå®çš„OCï¼Ÿæˆ‘åœ¨Hookä¸­æœ‰æ‰€æåŠï¼Œä½†æ˜¯åœ¨è¿™é‡Œæˆ‘ç»†è¯´ä¸€ä¸‹æˆ‘ç ”ç©¶çš„æ–¹æ³•ã€‚</p>
<p>æ¯”å¦‚æ‹¿</p>
<pre class="line-numbers language-objc" data-language="objc"><code class="language-objc">(@selector(postNotificationName:object:))((@selector(defaultCenter))(@class(NSNotificationCenter), &amp;@selector(defaultCenter)), &amp;@selector(postNotificationName:object:), @&quot;Registered&quot;, var_60);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>æ¥è¯´å§ï¼š</p>
<ol>
<li><p>é¦–å…ˆï¼Œå»æ‰æ‰€æœ‰<strong>å•ç‹¬æˆæ‹¬å·çš„é€‰æ‹©å™¨</strong>ï¼Œç‰¹å¾æ˜¯<code>(@selector(xâ€‹xx))</code>ï¼Œåªå¸¦@ä¸å¸¦&amp;å·ï¼Œè¿™äº›é€‰æ‹©å™¨æ²¡æœ‰åœ°å€ä¸è¢«è°ƒç”¨ï¼š</p>
<pre class="line-numbers language-objc" data-language="objc"><code class="language-objc">(@class(NSNotificationCenter), &amp;@selector(defaultCenter)), &amp;@selector(postNotificationName:object:), @&quot;Registered&quot;, var_60);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
<li><p>ç°åœ¨æ•´æ¡è¯­å¥åªå‰©ä¸‹ä¸€ä¸ªæ‹¬å·ï¼Œé‡Œé¢æœ‰è®¸å¤šâ€œé¡¹â€ï¼Œç”±é€—å·åˆ†éš”ã€‚ä»å¼€å¤´ä¸€ç›´å¾€åï¼Œé€é¡¹ç¿»è¯‘æˆçˆ¶å­å…³ç³»ï¼Œ<strong>é‡åˆ°æ–¹æ³•åç§°æ—¶ï¼Œå°†æ–¹æ³•åç§°åé¢çš„æ‰€æœ‰é¡¹ç¿»è¯‘æˆè¿™ä¸ªæ–¹æ³•çš„å‚æ•°</strong>ï¼ŒæŠŠå®ƒä»¬æŒ‰ç…§OCè¯­æ³•æ‹¼åœ¨ä¸€èµ·ï¼š</p>
<pre class="line-numbers language-objc" data-language="objc"><code class="language-objc">[NSNotificationCenter.defaultCenter postNotificationName:@&quot;Registered&quot; object:var_60];<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
<li><p>æœ€åï¼ŒæŠŠä¼ªä»£ç ä¸­çš„å˜é‡é€šè¿‡ä¸Šä¸‹æ–‡æ›¿æ¢æˆçœŸå®å€¼ã€‚åœ¨ä¼ªä»£ç ä¸­<code>var_60 = self;</code>ï¼Œæ‰€ä»¥è¿›è¡Œæ›¿æ¢ã€‚æœ€ç»ˆè¿˜åŸçš„ä»£ç ï¼š</p>
<pre class="line-numbers language-objc" data-language="objc"><code class="language-objc">[NSNotificationCenter.defaultCenter postNotificationName:@&quot;Registered&quot; object:self];<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>å…¶å®å°±æ˜¯æŠŠHopperç”Ÿæˆçš„æ›¿æ¢æˆhookç¯å¢ƒä¸­çœŸå®çš„ä¸œè¥¿çš„è¿‡ç¨‹ã€‚</p>
</li>
</ol>
<h1 id="THE-END"><a href="#THE-END" class="headerlink" title="THE END"></a>THE END</h1><p><strong>åˆ†æï¼ŒHookï¼ŒKGä¸€æ¡é¾™ï¼Œæ€»ç®—æ˜¯å®Œæˆäº†ã€‚</strong></p>

        </div>

        
            <div class="post-copyright-info">
                <div class="article-copyright-info-container">
    <ul>
        <li>æœ¬æ–‡æ ‡é¢˜ï¼šæ‰‹æŠŠæ‰‹æ•™ä½ ç©è½¬CrackMeç ´è§£äº”æ­¥èµ°</li>
        <li>æœ¬æ–‡ä½œè€…ï¼šTLHorse</li>
        <li>åˆ›å»ºæ—¶é—´ï¼š2021-02-17 14:44:56</li>
        <li>
            æœ¬æ–‡é“¾æ¥ï¼šhttps://tlhorse.github.io/posts/33a3e091/
        </li>
        <li>
            ç‰ˆæƒå£°æ˜ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-nd/4.0/deed.zh">BY-NC-ND</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼
        </li>
    </ul>
</div>

            </div>
        

        
            <div class="article-nav">
                
                    <div class="article-prev">
                        <a class="prev"
                           rel="prev"
                           href="/posts/55334894/"
                        >
                            <span class="left arrow-icon flex-center">
                              <i class="fas fa-chevron-left"></i>
                            </span>
                            <span class="title flex-center">
                                <span class="post-nav-title-item">ä½ å¥½ï¼Œå°é›€å„¿ä»¬</span>
                                <span class="post-nav-item">ä¸Šä¸€ç¯‡</span>
                            </span>
                        </a>
                    </div>
                
                
                    <div class="article-next">
                        <a class="next"
                           rel="next"
                           href="/posts/b833a77e/"
                        >
                            <span class="title flex-center">
                                <span class="post-nav-title-item">ä½ æ²¡çœ‹é”™ï¼šåŠ¨æ‰‹å¼€å‘GUIç®€å•æ“ä½œç³»ç»Ÿï¼ˆäºŒï¼‰</span>
                                <span class="post-nav-item">ä¸‹ä¸€ç¯‡</span>
                            </span>
                            <span class="right arrow-icon flex-center">
                              <i class="fas fa-chevron-right"></i>
                            </span>
                        </a>
                    </div>
                
            </div>
        

        
            <div class="comment-container">
                <div class="comments-container">
    <div id="comment-anchor"></div>
    <div class="comment-area-title">
        <i class="fas fa-comments">&nbsp;è¯„è®º</i>
    </div>
    
        
    <div id="gitalk-container"></div>
    <script 
            src="//cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.js"></script>
    <script >

        function loadGitalk() {
            let __gitalk__pathname = decodeURI(location.pathname);
            const __gitalk__pathnameLength = __gitalk__pathname.length;
            const __gitalk__pathnameMaxLength = 50;
            if (__gitalk__pathnameLength > __gitalk__pathnameMaxLength) {
                __gitalk__pathname = __gitalk__pathname.substring(0, __gitalk__pathnameMaxLength - 3) + '...';
            }

            try {
                Gitalk && new Gitalk({
                    clientID: '88d770a805d27a98e780',
                    clientSecret: 'c1c798735d6221391048e9225ae064e5e06ecdc8',
                    repo: 'TLBlogComments',
                    owner: 'TLHorse',
                    admin: ['TLHorse'],
                    id: __gitalk__pathname,
                    language: 'zh-CN'
                }).render('gitalk-container');

            } catch (e) {
                window.Gitalk = null;
            }
        }

        if ('false') {
            const loadGitalkTimeout = setTimeout(() => {
                loadGitalk();
                clearTimeout(loadGitalkTimeout);
            }, 1000);
        } else {
            window.addEventListener('DOMContentLoaded', loadGitalk);
        }
    </script>


    
</div>

            </div>
        
    </div>
</div>


                
            </div>

        </div>

        <div class="page-main-content-bottom">
            <footer class="footer">
    <div class="info-container">
        <div class="copyright-info info-item">
            &copy;
            
              <span>2020</span>&nbsp;-&nbsp;
            
            2022&nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;<a href="/">TLHorse</a>
        </div>
        
        <!-- <div class="theme-info info-item">
            ç”± <a target="_blank" href="https://hexo.io">Hexo</a> é©±åŠ¨&nbsp;|&nbsp;ä¸»é¢˜&nbsp;<a class="theme-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep v3.3.2</a>
        </div> -->
    </div>
</footer>

        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="tools-list">
        <!-- TOC aside toggle -->
        
            <li class="tools-item page-aside-toggle">
                <i class="fas fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
            <li class="go-comment">
                <i class="fas fa-comment"></i>
            </li>
        
    </ul>
</div>

        </div>
    

    <div class="right-bottom-side-tools">
        <div class="side-tools-container">
    <ul class="side-tools-list">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <li class="tools-item tool-expand-width flex-center">
            <i class="fas fa-arrows-alt-h"></i>
        </li>

        <li class="tools-item tool-dark-light-toggle flex-center">
            <i class="fas fa-moon"></i>
        </li>

        <!-- rss -->
        

        
            <li class="tools-item tool-scroll-to-top flex-center">
                <i class="fas fa-arrow-up"></i>
            </li>
        

        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list">
        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>
        
    </ul>
</div>

    </div>

    
        <aside class="page-aside">
            <div class="post-toc-wrap">
    <div class="post-toc">
        <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-text">å‰è¨€</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%88%86%E6%9E%90"><span class="nav-text">åˆ†æ</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3"><span class="nav-text">æš´åŠ›ç ´è§£</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Hook"><span class="nav-text">Hook</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%86%E6%9E%90-1"><span class="nav-text">åˆ†æ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E7%BC%96%E5%86%99"><span class="nav-text">ä»£ç ç¼–å†™</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%B3%A8%E5%86%8C%E6%9C%BA%E7%BC%96%E5%86%99"><span class="nav-text">æ³¨å†Œæœºç¼–å†™</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90"><span class="nav-text">ä»£ç åˆ†æ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B5%81%E7%A8%8B%E5%A4%8D%E7%8E%B0"><span class="nav-text">æµç¨‹å¤ç°</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BA%8F%E5%88%97%E5%8F%B7%E7%94%9F%E6%88%90"><span class="nav-text">åºåˆ—å·ç”Ÿæˆ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%8C%E5%96%84%E6%B3%A8%E5%86%8C%E6%9C%BA"><span class="nav-text">å®Œå–„æ³¨å†Œæœº</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%88%B0%E5%BA%95%E5%A6%82%E4%BD%95%E8%BF%98%E5%8E%9F%E4%BB%A3%E7%A0%81"><span class="nav-text">åˆ°åº•å¦‚ä½•è¿˜åŸä»£ç </span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#THE-END"><span class="nav-text">THE END</span></a></li></ol>
    </div>
</div>
        </aside>
    

    <div class="image-viewer-container">
    <img src="">
</div>


    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fas fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="æœç´¢..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="popup-btn-close">
                <i class="fas fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

</main>



<script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/header-shrink.js"></script><script src="/js/back2top.js"></script><script src="/js/dark-light-toggle.js"></script>


    <script src="/js/local-search.js"></script>






<div class="post-scripts">
    
        <script src="/js/left-side-toggle.js"></script><script src="/js/libs/anime.min.js"></script><script src="/js/toc.js"></script>
    
</div>



</body>
</html>
